# Development environment: Application + Database + PgAdmin

services:
  app:
    extends:
      file: docker-compose.base.yml
      service: app
    profiles: ["dev"]
    ports:
      - "${APP_PORT:-8000}:8000"
    environment:
      RELOAD: ${RELOAD:-1}
      PYTHONUNBUFFERED: 1
    security_opt:
      - no-new-privileges:true
    read_only: false
    tmpfs: []
    cap_drop:
      - NET_RAW
      - SYS_ADMIN
      - NET_BIND_SERVICE
    cap_add:
      - SETGID
      - SETUID

  db:
    extends:
      file: docker-compose.base.yml
      service: db
    profiles: ["dev"]
    ports:
      - "${DB_EXTERNAL_PORT:-5432}:5432"
    security_opt:
      - no-new-privileges:true
    read_only: false
    tmpfs: []
    cap_drop:
      - NET_RAW
      - SYS_ADMIN
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE

  pgadmin:
    extends:
      file: docker-compose.base.yml
      service: pgadmin
    profiles: ["dev"]
    ports:
      - "${PGADMIN_PORT:-8080}:80"
    security_opt:
      - no-new-privileges:true
    read_only: false
    tmpfs: []
    cap_drop:
      - NET_RAW
      - SYS_ADMIN
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
